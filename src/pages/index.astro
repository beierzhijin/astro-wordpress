---
import type { Block } from "@wp-block-tools/styles";
import BlockRenderer from "../components/BlockRenderer.astro";
import CommonHead from "../components/CommonHead.astro";

const response = await fetch(`${import.meta.env.WPGRAPHQL_URL}`, {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    query: `
      query PageQuery {
        nodeByUri(uri: "/") {
          ... on Page {
            id
            blocks
            seo {
              title
              metaDesc
            }
          }
        }
      }
    `,
  }),
});

const { data } = await response.json();
const blocks = (data.nodeByUri?.blocks || []) as Block[];
const seo = data.nodeByUri?.seo;
---

<html lang="en">
  <CommonHead title={seo.title || ""} description={seo.metaDesc ?? ""} />
  <body>
    <BlockRenderer blocks={blocks} />
  </body>
</html>
